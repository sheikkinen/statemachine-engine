stateDiagram-v2
    %% Detailed view of PROCESSING

    [*] --> checking_queue

    %% Internal transitions
    checking_queue --> spawning_batch : jobs_found
    spawning_batch --> spawning_batch : worker_spawned
    spawning_batch --> waiting_for_batch : batch_complete
    spawning_batch --> spawning_batch : job_taken
    waiting_for_batch --> checking_queue : all_jobs_complete
    waiting_for_batch --> waiting_for_batch : timeout(2)

    %% External composites
    state IDLE
    state ERROR

    %% Transitions to other composites
    checking_queue --> IDLE : no_jobs
    spawning_batch --> ERROR : spawn_failed
    waiting_for_batch --> ERROR : check_timeout