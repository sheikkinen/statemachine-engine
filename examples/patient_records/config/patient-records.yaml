name: "patient_records"
initial_state: waiting_for_report

# Define states with composite groupings for diagram visualization
states:
  - waiting_for_report
  # === PROCESSING STATES ===
  - summarizing
  - fact_checking
  # === COMPLETION STATES ===
  - ready  
  - failed

transitions:
  # Start processing a new report
  - from: waiting_for_report
    to: summarizing
    event: new_report
    actions:
      - type: log
        params:
          message: "üìÑ Starting to process report {report_id}: {report_title}"
          level: info

  # Convert report into paragraph summary
  - from: summarizing
    to: fact_checking
    event: summary_complete
    actions:
      - type: log
        params:
          message: "‚úçÔ∏è Generated summary for report {report_id}: {summary_text}"
          level: info

  # Validation loop - summary not based on report, try again
  - from: summarizing
    to: summarizing
    event: summary_invalid
    actions:
      - type: log
        params:
          message: "‚ö†Ô∏è Summary invalid for report {report_id}, retrying..."
          level: warning

  # Check that summary is based on report
  - from: fact_checking  
    to: ready
    event: validation_passed
    actions:
      - type: log
        params:
          message: "‚úÖ Report {report_id} validation passed - ready for history generation"
          level: success

  # Validation loop - facts don't match, go back to summarizing
  - from: fact_checking
    to: summarizing
    event: validation_failed
    actions:
      - type: log
        params:
          message: "‚ùå Fact check failed for report {report_id}, re-summarizing..."
          level: warning

  # Handle processing failures
  - from: summarizing
    to: failed
    event: processing_error
    actions:
      - type: log
        params:
          message: "üí• Processing error for report {report_id}: {error_message}"
          level: error

  - from: fact_checking
    to: failed
    event: processing_error
    actions:
      - type: log
        params:
          message: "üí• Fact checking error for report {report_id}: {error_message}"
          level: error

  # Reset failed reports for retry
  - from: failed
    to: waiting_for_report
    event: retry_report
    actions:
      - type: log
        params:
          message: "üîÑ Retrying failed report {report_id}"
          level: info

  # Process another report from ready state
  - from: ready
    to: waiting_for_report
    event: process_next
    actions:
      - type: log
        params:
          message: "‚ú® Report {report_id} complete, ready for next report"
          level: success

# Events that can be triggered externally
events:
  - new_report
  - summary_complete
  - summary_invalid
  - validation_passed
  - validation_failed
  - processing_error
  - retry_report
  - process_next

# Timeout configurations for realistic processing simulation
timeouts:
  # Summarizing takes 5-15 seconds typically
  - state: summarizing
    duration: 10
    event: summary_complete
    
  # Fact checking takes 3-8 seconds typically  
  - state: fact_checking
    duration: 5
    event: validation_passed